<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <meta name="description" content="Pip-Boy 3000 terminal interface for exploring Fallout universe lore. Browse tech, vaults, locations, factions, and timeline with authentic CRT effects and retro styling.">
    <meta name="keywords" content="Fallout, Pip-Boy, Wasteland, Vault-Tec, RobCo Industries, Post-Apocalyptic, Retro Terminal, CRT, Database, Lore">
    <meta name="author" content="Omni-Database Pip-Boy 3000 Contributors">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Omni-Database Pip-Boy 3000 - Fallout Lore Terminal">
    <meta property="og:description" content="Retro terminal interface for Fallout universe lore database. Experience authentic Pip-Boy 3000 with CRT effects, scanlines, and comprehensive wasteland data.">
    <meta property="og:site_name" content="Pip-Boy 3000 Omni-Database">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Omni-Database Pip-Boy 3000 - Fallout Lore Terminal">
    <meta name="twitter:description" content="Retro terminal interface for Fallout universe lore. Browse tech, vaults, locations, and timeline with authentic CRT effects.">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ò¢Ô∏è</text></svg>">

    <title>RobCo Industries Termlink - Omni-Database v8.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        :root {
            --term-green: #33ff33;
            --term-dim: #1a4d1a;
            --term-bg: #050505;
            --term-amber: #ffb000;
            --term-red: #ff3333;
            --term-blue: #33bbff;
        }

        body {
            background-color: var(--term-bg);
            color: var(--term-green);
            font-family: 'VT323', monospace;
            overflow: hidden;
            height: 100vh;
            margin: 0;
            padding: 0;
        }

        /* CRT Effects */
        .crt-overlay {
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 50;
        }

        .scanline {
            width: 100%;
            height: 6px;
            background: rgba(51, 255, 51, 0.08);
            position: fixed;
            top: 0;
            z-index: 51;
            animation: scanline 4s linear infinite;
            pointer-events: none;
            will-change: transform;
            transform: translateZ(0);
        }

        @keyframes scanline {
            0% { transform: translateY(-10vh) translateZ(0); }
            100% { transform: translateY(110vh) translateZ(0); }
        }

        /* Boot Screen */
        #boot-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .pip-btn {
            background: #001100;
            border: 1px solid var(--term-green);
            color: var(--term-green);
            text-transform: uppercase;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        .pip-btn:hover {
            background: var(--term-green);
            color: #000;
            box-shadow: 0 0 15px var(--term-green);
        }
        .pip-btn.active {
            background: var(--term-green);
            color: #000;
            font-weight: bold;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
        }

        .content-box {
            border: 1px solid var(--term-green);
            background: rgba(0, 15, 0, 0.9);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.1);
        }
        
        .holo-img {
            filter: grayscale(100%) sepia(100%) hue-rotate(50deg) saturate(300%) contrast(1.1) brightness(0.8);
            border: 2px solid var(--term-green);
            image-rendering: pixelated;
            transition: 0.3s;
        }
        .holo-img:hover {
            filter: none;
            border-color: #fff;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(min(100%, 280px), 1fr));
            gap: 1.5rem;
        }

        .data-card {
            border: 1px solid var(--term-green);
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(0,20,0,0.5);
        }
        .data-card:hover {
            background: var(--term-green);
            color: black;
            transform: translateY(-5px);
        }

        .theme-tech .pip-btn.active { background: var(--term-amber); border-color: var(--term-amber); color: black; }
        .theme-tech { --term-green: var(--term-amber); }
        .theme-vaults .pip-btn.active { background: var(--term-blue); border-color: var(--term-blue); color: black; }
        .theme-vaults { --term-green: var(--term-blue); }
        .theme-history .pip-btn.active { background: #ffcc00; border-color: #ffcc00; color: black; }
        .theme-history { --term-green: #ffcc00; }

        /* Scrollbar - WebKit */
        ::-webkit-scrollbar { width: 12px; }
        ::-webkit-scrollbar-track { background: #000; border-left: 1px solid var(--term-green); }
        ::-webkit-scrollbar-thumb { background: var(--term-green); }

        /* Scrollbar - Firefox */
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--term-green) #000;
        }

        /* Focus styles for accessibility */
        *:focus {
            outline: 2px solid var(--term-green);
            outline-offset: 2px;
        }

        .pip-btn:focus {
            outline: 3px solid var(--term-green);
            box-shadow: 0 0 20px var(--term-green);
        }

        .data-card:focus {
            outline: 3px solid currentColor;
            transform: translateY(-3px);
            background: rgba(255,255,255,0.15);
        }

        /* Skip navigation link */
        .skip-link {
            position: absolute;
            top: -100px;
            left: 0;
            background: var(--term-green);
            color: #000;
            padding: 8px 16px;
            z-index: 1000;
            font-weight: bold;
            text-decoration: none;
        }

        .skip-link:focus {
            top: 0;
        }

        .archive-tag {
            font-size: 0.7rem;
            background: rgba(0,0,0,0.5);
            padding: 2px 6px;
            border: 1px solid currentColor;
            margin-right: 5px;
            display: inline-block;
        }

        .spec-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(100, 100, 100, 0.3);
        }
        .spec-row:last-child {
            border-bottom: none;
        }

        .items-card {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        /* Semantic button styling */
        button.data-card {
            width: 100%;
            text-align: left;
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
            appearance: none;
            -webkit-appearance: none;
            display: block;
        }

        button.items-card {
            display: flex;
        }

        /* Line clamp utility for search results */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Reduced motion support for accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }

            .scanline {
                display: none;
            }
        }
    </style>
</head>
<body>

    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div class="crt-overlay"></div>
    <div class="scanline"></div>

    <!-- BOOT SCREEN -->
    <div id="boot-screen">
        <div class="mb-8 text-center space-y-2">
            <p>ROBCO INDUSTRIES (TM) TERMLINK PROTOCOL</p>
            <p>COPYRIGHT 2075-2077 ROBCO INDUSTRIES</p>
            <p>-SERVER 6-</p>
        </div>
        
        <div id="lang-select" class="flex flex-col sm:flex-row gap-4">
            <button data-lang="pl" class="pip-btn px-8 py-4 text-xl sm:text-2xl" aria-label="Select Polish language">POLSKI</button>
            <button data-lang="en" class="pip-btn px-8 py-4 text-xl sm:text-2xl" aria-label="Select English language">ENGLISH</button>
        </div>

        <div id="start-btn-container" class="hidden mt-8 text-center">
            <p class="mb-4 text-amber-400 animate-pulse">SYSTEM INITIALIZED</p>
            <button data-action="init" class="pip-btn px-12 py-4 text-3xl font-bold border-2 border-amber-400 text-amber-400 hover:bg-amber-400 hover:text-black" aria-label="Initialize database system">
                > INITIALIZE
            </button>
        </div>
    </div>

    <!-- MAIN INTERFACE (Hidden initially) -->
    <div class="relative z-10 h-full flex flex-col max-w-[1920px] mx-auto p-2 md:p-4 border-x-8 border-[#33ff33] bg-[#020202] transition-colors duration-500 hidden" id="main-interface" role="main">
        
        <header class="flex justify-between items-end border-b-4 border-[#33ff33] pb-4 mb-4 bg-[#001500] p-4 transition-colors duration-500" id="header-container">
            <div class="flex items-center gap-6">
                <div class="w-16 h-16 md:w-24 md:h-24 border-2 border-[#33ff33] rounded-full flex items-center justify-center bg-black relative animate-[pulse_4s_infinite]" id="logo-container">
                    <span class="text-3xl md:text-5xl flex items-center justify-center">
                        <svg viewBox="-3 -3 6 6" class="w-[1em] h-[1em] fill-current" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                            <defs>
                                <mask id="rad-mask" maskUnits="userSpaceOnUse" x="-3" y="-3" width="6" height="6">
                                    <circle r="1.625" fill="none" stroke="white" stroke-width="1.75"/>
                                </mask>
                            </defs>
                            <circle r=".5" fill="currentColor"/>
                            <g mask="url(#rad-mask)" fill="currentColor">
                                <g id="rad-blade">
                                    <path id="rad-blade-part" transform="rotate(30)" d="m0 0v2.88h3"/>
                                    <use transform="scale(-1,1)" xlink:href="#rad-blade-part"/>
                                </g>
                                <use transform="rotate(120)" xlink:href="#rad-blade"/>
                                <use transform="rotate(240)" xlink:href="#rad-blade"/>
                            </g>
                        </svg>
                    </span>
                </div>
                <div>
                    <h1 class="text-3xl md:text-4xl lg:text-6xl font-bold tracking-widest uppercase" style="text-shadow: 2px 2px 0px rgba(0,0,0,0.5);" id="header-title">PIP-BOY 3000</h1>
                    <div class="flex items-center gap-4 text-xl opacity-90 mt-1">
                        <span class="bg-[#33ff33] text-black px-2 font-bold" id="model-badge">MK VII</span>
                        <span id="header-subtitle">OMNI-DATABASE</span>
                    </div>
                </div>
            </div>
            <div class="text-right hidden md:block font-mono text-xs lg:text-lg opacity-80" id="header-info">
                <!-- Injected via JS -->
            </div>
        </header>

        <nav class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-8 gap-2 mb-4 md:mb-6 text-sm sm:text-base lg:text-xl font-bold tracking-wider overflow-x-auto" id="nav-container" aria-label="Primary navigation">
            <!-- Buttons injected via JS -->
        </nav>

        <!-- SEARCH CONTAINER -->
        <div id="search-container" class="hidden mb-4 px-2">
            <div class="content-box border-[#33ff33] border-2 p-3 bg-[#001100]">
                <div class="flex gap-2 mb-3">
                    <input type="text"
                           id="search-input"
                           class="flex-1 bg-black border border-[#33ff33] text-[#33ff33] px-3 py-2 font-mono uppercase placeholder:text-[#33ff33] placeholder:opacity-50 focus:outline-none focus:border-2 focus:shadow-[0_0_10px_#33ff33]"
                           placeholder="SEARCH DATABASE..."
                           aria-label="Search database"
                           autocomplete="off">
                    <button id="search-clear" class="pip-btn px-4 py-2 text-sm" aria-label="Clear search">CLEAR</button>
                </div>
                <div id="search-results" class="hidden mt-3 max-h-96 overflow-y-auto custom-scrollbar"></div>
            </div>
        </div>

        <main id="main-content" class="flex-grow overflow-y-auto px-2 md:px-0 md:pr-4 pb-10 text-base md:text-lg lg:text-xl leading-relaxed custom-scrollbar relative" aria-live="polite">
            <!-- Content injected via JS -->
        </main>

        <footer class="mt-2 border-t-4 border-[#33ff33] bg-[#001100] p-2 md:p-3 flex flex-col sm:flex-row justify-between items-center gap-2 sm:gap-4 font-bold uppercase transition-colors duration-500" id="footer-container">
            <div class="flex gap-4 md:gap-8 text-xs md:text-sm">
                <span class="border border-current px-2 py-1">HP: 100%</span>
                <span class="border border-current px-2 py-1">RADS: 0</span>
            </div>
            <div class="text-xs opacity-60 tracking-[0.2em] text-center sm:text-right" id="footer-text">
                ROBCO INDUSTRIES ¬© 2077
            </div>
        </footer>
    </div>

    <script>
        const app = {
            currentLang: null,
            db: {},
            currentTab: 'status',
            clockInterval: null,
            searchIndex: null,

            // Favorites Management (localStorage)
            favorites: {
                load: function() {
                    const stored = localStorage.getItem('pipboy-favorites');
                    return stored ? JSON.parse(stored) : [];
                },

                save: function(favs) {
                    localStorage.setItem('pipboy-favorites', JSON.stringify(favs));
                },

                add: function(module, category, itemId) {
                    const favs = this.load();
                    const key = `${module}:${category}:${itemId}`;
                    if (!favs.includes(key)) {
                        favs.push(key);
                        this.save(favs);
                    }
                },

                remove: function(module, category, itemId) {
                    const favs = this.load();
                    const key = `${module}:${category}:${itemId}`;
                    this.save(favs.filter(f => f !== key));
                },

                has: function(module, category, itemId) {
                    return this.load().includes(`${module}:${category}:${itemId}`);
                }
            },

            // Security: Sanitize data attributes
            sanitizeDataAttr: function(str) {
                return String(str).replace(/['"<>&]/g, '');
            },

            // Event Delegation System
            attachEventListeners: function() {
                // Boot screen events
                document.getElementById('boot-screen').addEventListener('click', this.handleBootClick.bind(this));

                // Main interface events (attached after system loads)
                const navContainer = document.getElementById('nav-container');
                const mainContent = document.getElementById('main-content');

                if (navContainer) {
                    navContainer.addEventListener('click', this.handleNavClick.bind(this));
                }
                if (mainContent) {
                    mainContent.addEventListener('click', this.handleContentClick.bind(this));
                }
            },

            handleBootClick: function(e) {
                // Language selection
                const langBtn = e.target.closest('[data-lang]');
                if (langBtn) {
                    this.selectLang(langBtn.dataset.lang);
                    return;
                }

                // Initialize button
                const initBtn = e.target.closest('[data-action="init"]');
                if (initBtn) {
                    this.enterSystem();
                    return;
                }

                // Error screen reload button
                const reloadBtn = e.target.closest('[data-action="reload"]');
                if (reloadBtn) {
                    location.reload();
                }
            },

            handleNavClick: function(e) {
                const btn = e.target.closest('[data-tab]');
                if (btn) {
                    this.changeTab(btn.dataset.tab);
                }
            },

            handleContentClick: function(e) {
                const target = e.target.closest('[data-action]');
                if (!target) return;

                const action = target.dataset.action;
                const tabKey = target.dataset.tab;
                const catId = target.dataset.category;
                const itemId = target.dataset.item;

                switch(action) {
                    case 'show-category':
                        this.renderCategoryView(tabKey);
                        break;
                    case 'show-items':
                        this.renderItemsView(tabKey, catId);
                        break;
                    case 'show-detail':
                        this.renderDetailView(tabKey, catId, itemId);
                        break;
                    case 'toggle-favorite':
                        this.toggleFavorite(tabKey, catId, itemId, target);
                        break;
                }
            },

            // Toggle Favorite
            toggleFavorite: function(tabKey, catId, itemId, button) {
                const isFavorited = this.favorites.has(tabKey, catId, itemId);

                if (isFavorited) {
                    this.favorites.remove(tabKey, catId, itemId);
                    button.innerHTML = '‚òÜ FAVORITE';
                    button.classList.remove('bg-amber-500/20');
                } else {
                    this.favorites.add(tabKey, catId, itemId);
                    button.innerHTML = '‚òÖ FAVORITED';
                    button.classList.add('bg-amber-500/20');
                }
            },

            // Search System
            buildSearchIndex: function() {
                const index = [];
                const modules = ['tech', 'timeline', 'vaults', 'locations', 'bestiary', 'factions', 'vanburen'];

                modules.forEach(moduleKey => {
                    const module = this.db[moduleKey];
                    if (!module?.items) return;

                    Object.entries(module.items).forEach(([catId, items]) => {
                        if (!Array.isArray(items)) return;

                        items.forEach(item => {
                            index.push({
                                module: moduleKey,
                                category: catId,
                                id: item.id,
                                name: item.name.toLowerCase(),
                                lore: item.lore ? item.lore.toLowerCase() : '',
                                specs: JSON.stringify(item.specs).toLowerCase(),
                                displayName: item.name,
                                displayLore: item.lore || ''
                            });
                        });
                    });
                });

                this.searchIndex = index;
            },

            performSearch: function(query) {
                if (!this.searchIndex) this.buildSearchIndex();
                if (!query || query.length < 2) return [];

                const lowerQuery = query.toLowerCase();
                return this.searchIndex
                    .filter(item =>
                        item.name.includes(lowerQuery) ||
                        item.lore.includes(lowerQuery) ||
                        item.specs.includes(lowerQuery)
                    )
                    .slice(0, 20); // Limit to 20 results
            },

            renderSearchResults: function(results) {
                const container = document.getElementById('search-results');

                if (results.length === 0) {
                    container.innerHTML = '<p class="text-center text-amber-400 py-4">[NO RESULTS FOUND]</p>';
                    container.classList.remove('hidden');
                    return;
                }

                const moduleColors = {
                    tech: 'border-amber-300 hover:border-amber-400 hover:bg-amber-900/20',
                    timeline: 'border-blue-300 hover:border-blue-400 hover:bg-blue-900/20',
                    vaults: 'border-[#33ff33] hover:border-[#44ff44] hover:bg-green-900/20',
                    locations: 'border-gray-400 hover:border-gray-300 hover:bg-gray-900/20',
                    bestiary: 'border-red-400 hover:border-red-300 hover:bg-red-900/20',
                    factions: 'border-white hover:border-gray-200 hover:bg-white/10',
                    vanburen: 'border-purple-400 hover:border-purple-300 hover:bg-purple-900/20'
                };

                container.innerHTML = `
                    <div class="text-sm mb-2 opacity-70">${results.length} RESULT${results.length !== 1 ? 'S' : ''} FOUND</div>
                    <div class="space-y-2">
                        ${results.map(result => {
                            const colorClass = moduleColors[result.module] || 'border-[#33ff33]';
                            return `
                                <button type="button"
                                        class="w-full text-left border-2 ${colorClass} p-3 transition-all duration-200 hover:translate-x-1"
                                        data-action="show-detail"
                                        data-tab="${this.sanitizeDataAttr(result.module)}"
                                        data-category="${this.sanitizeDataAttr(result.category)}"
                                        data-item="${this.sanitizeDataAttr(result.id)}"
                                        aria-label="View ${result.displayName}">
                                    <div class="font-bold text-lg">${result.displayName}</div>
                                    <div class="text-xs opacity-70 mt-1">
                                        ${result.module.toUpperCase()} / ${result.category.toUpperCase()}
                                    </div>
                                    <div class="text-sm mt-2 opacity-90 line-clamp-2">
                                        ${result.displayLore}
                                    </div>
                                </button>
                            `;
                        }).join('')}
                    </div>
                `;

                container.classList.remove('hidden');
            },

            initSearch: function() {
                const input = document.getElementById('search-input');
                const clearBtn = document.getElementById('search-clear');
                const container = document.getElementById('search-container');
                const resultsDiv = document.getElementById('search-results');
                let searchTimeout;

                if (!input || !clearBtn) return;

                // Show search container when system loads
                container.classList.remove('hidden');

                // Debounced search on input
                input.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    const query = e.target.value.trim();

                    if (query.length < 2) {
                        resultsDiv.classList.add('hidden');
                        return;
                    }

                    searchTimeout = setTimeout(() => {
                        const results = this.performSearch(query);
                        this.renderSearchResults(results);
                    }, 300); // 300ms debounce
                });

                // Clear button
                clearBtn.addEventListener('click', () => {
                    input.value = '';
                    resultsDiv.classList.add('hidden');
                    input.focus();
                });

                // Clear on Escape key
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        input.value = '';
                        resultsDiv.classList.add('hidden');
                        input.blur();
                    }
                });
            },

            // Keyboard Navigation System
            initKeyboardNav: function() {
                document.addEventListener('keydown', (e) => {
                    // Ignore keyboard shortcuts if user is typing in an input
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                        // Allow Escape to blur/exit input
                        if (e.key === 'Escape') {
                            e.target.blur();
                        }
                        return;
                    }

                    // Escape: Go back to previous view
                    if (e.key === 'Escape') {
                        const backBtn = document.querySelector('[data-action="show-category"], [data-action="show-items"]');
                        if (backBtn) {
                            backBtn.click();
                            e.preventDefault();
                        }
                    }

                    // Arrow keys: Navigate grid/list items
                    if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                        this.handleArrowKeys(e);
                    }

                    // Number keys 1-8: Switch tabs
                    if (e.key >= '1' && e.key <= '8') {
                        const tabs = ['status', 'timeline', 'tech', 'vaults', 'locations', 'bestiary', 'factions', 'vanburen'];
                        const tabIndex = parseInt(e.key) - 1;
                        if (tabs[tabIndex]) {
                            this.changeTab(tabs[tabIndex]);
                            e.preventDefault();
                        }
                    }

                    // / or Ctrl+F: Focus search (future Phase 4.1)
                    if (e.key === '/' || (e.ctrlKey && e.key === 'f')) {
                        const searchInput = document.getElementById('search-input');
                        if (searchInput) {
                            searchInput.focus();
                            e.preventDefault();
                        }
                    }
                });
            },

            // Arrow key navigation helper
            handleArrowKeys: function(e) {
                const focusableElements = Array.from(document.querySelectorAll(
                    '#main-content button[data-action], #nav-container button[data-tab], .pip-btn:not([disabled])'
                ));

                if (focusableElements.length === 0) return;

                const currentIndex = focusableElements.indexOf(document.activeElement);

                // If nothing focused, focus first element on any arrow key
                if (currentIndex === -1) {
                    focusableElements[0].focus();
                    e.preventDefault();
                    return;
                }

                let nextIndex = currentIndex;

                // Determine grid layout (check if elements are in a grid)
                const currentElement = focusableElements[currentIndex];
                const parent = currentElement.closest('.data-grid, .grid');

                if (parent) {
                    // Grid navigation
                    const computedStyle = window.getComputedStyle(parent);
                    const gridCols = computedStyle.gridTemplateColumns.split(' ').length;

                    switch(e.key) {
                        case 'ArrowRight':
                            nextIndex = Math.min(currentIndex + 1, focusableElements.length - 1);
                            break;
                        case 'ArrowLeft':
                            nextIndex = Math.max(currentIndex - 1, 0);
                            break;
                        case 'ArrowDown':
                            nextIndex = Math.min(currentIndex + gridCols, focusableElements.length - 1);
                            break;
                        case 'ArrowUp':
                            nextIndex = Math.max(currentIndex - gridCols, 0);
                            break;
                    }
                } else {
                    // Linear navigation (list or nav bar)
                    switch(e.key) {
                        case 'ArrowRight':
                        case 'ArrowDown':
                            nextIndex = (currentIndex + 1) % focusableElements.length;
                            break;
                        case 'ArrowLeft':
                        case 'ArrowUp':
                            nextIndex = (currentIndex - 1 + focusableElements.length) % focusableElements.length;
                            break;
                    }
                }

                if (nextIndex !== currentIndex && focusableElements[nextIndex]) {
                    focusableElements[nextIndex].focus();
                    e.preventDefault();
                }
            },

            // 1. Language Selection
            selectLang: function(lang) {
                this.currentLang = lang;
                document.documentElement.lang = lang; // Update HTML lang attribute
                document.getElementById('lang-select').classList.add('hidden');
                document.getElementById('start-btn-container').classList.remove('hidden');
            },

            // 2. Load Data & Start
            enterSystem: async function() {
                console.log('[SYSTEM] Initializing...');
                const filename = `database-${this.currentLang}.json`;

                // Show loading indicator
                const bootScreen = document.getElementById('boot-screen');
                const startBtn = document.getElementById('start-btn-container');

                const updateStatus = (msg) => {
                    startBtn.innerHTML = `<p class="text-amber-400 text-lg">${msg}</p>`;
                };

                updateStatus('STEP 1/5: INITIALIZING...');

                try {
                    console.log(`[SYSTEM] Fetching ${filename}...`);
                    updateStatus(`STEP 2/5: FETCHING ${filename.toUpperCase()}...`);

                    const response = await fetch(filename);
                    console.log('[SYSTEM] Fetch complete, status:', response.status);
                    updateStatus(`STEP 3/5: PARSING DATA (${response.status})...`);

                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                    console.log('[SYSTEM] Parsing JSON...');
                    this.db = await response.json();
                    console.log('[SYSTEM] Database loaded successfully:', Object.keys(this.db));

                    updateStatus('STEP 4/5: INITIALIZING INTERFACE...');
                    console.log('[SYSTEM] Hiding boot screen...');
                    bootScreen.style.display = 'none';
                    const mainInterface = document.getElementById('main-interface');
                    mainInterface.classList.remove('hidden');
                    mainInterface.style.display = 'flex';

                    console.log('[SYSTEM] Initializing UI...');
                    this.initUI();

                    updateStatus('STEP 5/5: LOADING CONTENT...');
                    console.log('[SYSTEM] Changing to status tab...');
                    this.changeTab('status');

                    console.log('[SYSTEM] Starting clock...');
                    if (this.clockInterval) clearInterval(this.clockInterval);
                    this.clockInterval = setInterval(() => this.updateClock(), 1000);
                    this.updateClock();

                    console.log('[SYSTEM] Initialization complete!');

                } catch (e) {
                    console.error("[SYSTEM] Critical Failure:", e);
                    console.error("[SYSTEM] Error stack:", e.stack);

                    // Show error on screen
                    const isFileProtocol = window.location.protocol === 'file:';
                    const errorMsg = isFileProtocol
                        ? `CRITICAL ERROR: FILE PROTOCOL DETECTED\n\nYou are opening this file directly in your browser.\nThis blocks database loading for security reasons.\n\nSOLUTION:\n1. Use VS Code Live Server extension, OR\n2. Run: python -m http.server 8000\n3. Then open: http://localhost:8000`
                        : `CRITICAL ERROR: COULD NOT LOAD ${filename}\n\nError: ${e.message}\n\nCheck browser console for details.`;

                    startBtn.innerHTML = `
                        <div class="border-2 border-red-500 bg-black p-6 text-red-500 text-left max-w-2xl">
                            <h3 class="text-2xl font-bold mb-4 text-center">‚ö† SYSTEM FAILURE ‚ö†</h3>
                            <pre class="text-sm whitespace-pre-wrap font-mono">${errorMsg}</pre>
                            <button data-action="reload" class="pip-btn px-6 py-2 mt-4 w-full border-red-500 text-red-500 hover:bg-red-500">
                                > RESTART SYSTEM
                            </button>
                        </div>
                    `;
                }
            },

            // 3. Initialize Static UI Text
            initUI: function() {
                const ui = this.db.ui;
                document.getElementById('header-subtitle').innerText = ui.title;
                document.getElementById('footer-text').innerText = ui.footer;

                // Build Nav Buttons
                const nav = document.getElementById('nav-container');
                nav.innerHTML = '';
                Object.keys(ui.nav).forEach(key => {
                    let classes = "pip-btn py-3";
                    // Specific styling for keys
                    if (key === 'tech') classes += " text-amber-300 border-amber-300";
                    if (key === 'vaults') classes += " text-blue-400 border-blue-400";
                    if (key === 'timeline') classes += " text-yellow-400 border-yellow-400";

                    nav.innerHTML += `<button data-tab="${this.sanitizeDataAttr(key)}"
                                              id="btn-${key}"
                                              class="${classes}"
                                              aria-label="Navigate to ${ui.nav[key]} section">${ui.nav[key]}</button>`;
                });

                // Attach event listeners for main interface
                this.attachEventListeners();

                // Initialize keyboard navigation
                this.initKeyboardNav();

                // Initialize search system
                this.initSearch();
            },

            // 4. Tab Switching Logic
            changeTab: function(tabName) {
                this.currentTab = tabName;
                document.querySelectorAll('.pip-btn').forEach(btn => btn.classList.remove('active'));
                const btn = document.getElementById(`btn-${tabName}`);
                if(btn) btn.classList.add('active');

                // Update Header Info
                const ui = this.db.ui;
                const accessText = this.currentLang === 'pl' ? 'DOSTƒòP' : 'ACCESS';
                const timeText = this.currentLang === 'pl' ? 'CZAS' : 'TIME';
                
                document.getElementById('header-info').innerHTML = `
                    <p>${ui.access}</p>
                    <p>${ui.module}: <span class="font-bold text-amber-400">${tabName.toUpperCase()}</span></p>
                    <p>${timeText}: <span id="clock">00:00:00</span></p>
                `;

                // Theme
                const theme = this.db[tabName]?.theme || '';
                document.getElementById('main-interface').className = `relative z-10 h-full flex flex-col max-w-[1920px] mx-auto p-2 md:p-4 border-x-8 bg-[#020202] transition-colors duration-500 ${theme}`;

                // Render
                const main = document.getElementById('main-content');
                main.style.opacity = '0';
                setTimeout(() => {
                    if (tabName === 'status') this.renderStatus();
                    else if (this.db[tabName]) this.renderCategoryView(tabName);
                    main.style.opacity = '1';
                }, 150);
            },

            updateClock: function() {
                const clock = document.getElementById('clock');
                if(clock) clock.innerText = new Date().toLocaleTimeString(app.currentLang === 'pl' ? 'pl-PL' : 'en-US');
            },

            // --- RENDERERS ---
            renderStatus: function() {
                const ui = this.db.ui;
                document.getElementById('main-content').innerHTML = `
                    <div class="h-full flex flex-col justify-center items-center text-center animate-[fadeIn_0.5s]">
                        <div class="content-box p-10 border-4 border-[#33ff33]">
                            <h2 class="text-5xl font-bold mb-4">${ui.status_msg}</h2>
                            <p class="text-xl mb-6">${ui.status_sub}</p>
                            <!-- GRAPHIC PLACEHOLDER: MAIN_LOGO_PNG -->
                            <div class="w-32 h-32 mx-auto border border-dashed border-[#33ff33] flex items-center justify-center opacity-50">
                                [LOGO.PNG]
                            </div>
                        </div>
                    </div>`;
            },

            // Breadcrumb Navigation Helper
            renderBreadcrumb: function(parts) {
                const separator = '<span class="mx-2 opacity-50">></span>';

                return `
                    <nav aria-label="Breadcrumb" class="text-sm mb-4 opacity-80 px-2">
                        ${parts.map((part, i) => {
                            if (i === parts.length - 1) {
                                // Last item - current page (not clickable)
                                return `<span class="text-amber-400 font-bold">${part.label}</span>`;
                            } else {
                                // Clickable breadcrumb links
                                return `<button type="button"
                                                class="hover:text-amber-400 underline hover:no-underline transition-colors"
                                                data-action="${part.action}"
                                                ${part.tab ? `data-tab="${this.sanitizeDataAttr(part.tab)}"` : ''}
                                                ${part.category ? `data-category="${this.sanitizeDataAttr(part.category)}"` : ''}
                                                aria-label="Go back to ${part.label}">
                                            ${part.label}
                                        </button>`;
                            }
                        }).join(separator)}
                    </nav>
                `;
            },

            renderCategoryView: function(tabKey) {
                const data = this.db[tabKey];
                const main = document.getElementById('main-content');
                const titleClass = data.color;
                const borderClass = data.border;
                const ui = this.db.ui;

                const breadcrumb = this.renderBreadcrumb([
                    {label: ui.status_msg, action: 'change-tab', tab: 'status'},
                    {label: data.title}
                ]);

                main.innerHTML = `
                    ${breadcrumb}
                    <div class="content-box ${borderClass} bg-opacity-50">
                        <h2 class="text-4xl mb-4 font-bold ${titleClass} border-b ${borderClass} pb-2">${data.title}</h2>
                        <div class="data-grid">
                            ${data.categories.map(cat => `
                                <button type="button"
                                        data-action="show-items"
                                        data-tab="${this.sanitizeDataAttr(tabKey)}"
                                        data-category="${this.sanitizeDataAttr(cat.id)}"
                                        class="data-card group ${borderClass} ${titleClass} hover:bg-white/10"
                                        aria-label="View ${cat.name} category: ${cat.desc}">
                                    <div class="text-6xl mb-2 group-hover:scale-110 transition" role="img" aria-label="${cat.icon}">${cat.icon}</div>
                                    <h3 class="text-2xl font-bold mb-2">${cat.name}</h3>
                                    <p class="text-sm opacity-80 text-gray-300">${cat.desc}</p>
                                </button>
                            `).join('')}
                        </div>
                    </div>`;
            },

            renderItemsView: function(tabKey, catId) {
                const data = this.db[tabKey];
                const cat = data.categories.find(c => c.id === catId);
                const items = data.items[catId] || [];
                const main = document.getElementById('main-content');
                const titleClass = data.color;
                const borderClass = data.border;
                const backBtnText = this.currentLang === 'pl' ? '<< KATEGORIE' : '<< CATEGORIES';
                const ui = this.db.ui;

                const breadcrumb = this.renderBreadcrumb([
                    {label: ui.status_msg, action: 'change-tab', tab: 'status'},
                    {label: data.title, action: 'show-category', tab: tabKey},
                    {label: cat.name}
                ]);

                // Empty state check
                if (items.length === 0) {
                    const emptyMsg = this.currentLang === 'pl' ? 'DANE NIEDOSTƒòPNE' : 'DATA UNAVAILABLE';
                    const maintenanceMsg = this.currentLang === 'pl' ? 'Ta sekcja jest w trakcie konserwacji.' : 'This section is under maintenance.';

                    main.innerHTML = `
                        ${breadcrumb}
                        <div class="content-box ${borderClass}">
                            <div class="flex justify-between items-center mb-6 border-b ${borderClass} pb-2">
                                <button data-action="show-category"
                                        data-tab="${this.sanitizeDataAttr(tabKey)}"
                                        class="pip-btn px-4 py-1 text-sm ${borderClass} ${titleClass} hover:bg-white/20"
                                        aria-label="Back to categories">${backBtnText}</button>
                                <h2 class="text-3xl font-bold ${titleClass}">${cat.name}</h2>
                            </div>
                            <div class="border-2 border-dashed ${borderClass} p-10 text-center bg-black/30">
                                <p class="text-6xl mb-4 opacity-50">üìÅ</p>
                                <p class="text-2xl text-amber-400 font-bold mb-2">[${emptyMsg}]</p>
                                <p class="text-sm opacity-70">${maintenanceMsg}</p>
                            </div>
                        </div>`;
                    return;
                }

                main.innerHTML = `
                    ${breadcrumb}
                    <div class="content-box ${borderClass}">
                        <div class="flex justify-between items-center mb-6 border-b ${borderClass} pb-2">
                            <button data-action="show-category"
                                    data-tab="${this.sanitizeDataAttr(tabKey)}"
                                    class="pip-btn px-4 py-1 text-sm ${borderClass} ${titleClass} hover:bg-white/20"
                                    aria-label="Back to categories">${backBtnText}</button>
                            <h2 class="text-3xl font-bold ${titleClass}">${cat.name}</h2>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            ${items.map(item => `
                                <button type="button"
                                        data-action="show-detail"
                                        data-tab="${this.sanitizeDataAttr(tabKey)}"
                                        data-category="${this.sanitizeDataAttr(catId)}"
                                        data-item="${this.sanitizeDataAttr(item.id)}"
                                        class="data-card items-card p-4 ${borderClass} hover:bg-white/10 group"
                                        aria-label="View details for ${item.name}">
                                    <img src="${item.img}"
                                         alt="${item.name}"
                                         loading="lazy"
                                         class="w-24 h-20 md:w-32 md:h-24 object-cover border ${borderClass} group-hover:border-white flex-shrink-0">
                                    <div class="min-w-0">
                                        <h3 class="text-lg md:text-xl font-bold ${titleClass} mb-1 group-hover:text-white truncate">${item.name}</h3>
                                        <div class="flex flex-wrap gap-1 md:gap-2">
                                            ${Object.keys(item.specs).slice(0,2).map(key => `<span class="archive-tag">${key}: ${item.specs[key]}</span>`).join('')}
                                        </div>
                                    </div>
                                </button>
                            `).join('')}
                        </div>
                    </div>`;
            },

            renderDetailView: function(tabKey, catId, itemId) {
                const data = this.db[tabKey];
                const cat = data.categories.find(c => c.id === catId);
                const items = data.items[catId];
                const item = items.find(i => i.id === itemId);
                const main = document.getElementById('main-content');
                const titleClass = data.color;
                const borderClass = data.border;
                const backBtnText = this.currentLang === 'pl' ? '<< LISTA' : '<< LIST';
                const specsText = this.currentLang === 'pl' ? 'SPECYFIKACJA' : 'SPECS';
                const loreText = this.currentLang === 'pl' ? 'ARCHIWUM (LORE)' : 'ARCHIVE (LORE)';
                const dataText = this.currentLang === 'pl' ? 'DANE SZCZEG√ì≈ÅOWE' : 'DETAILED DATA';
                const ui = this.db.ui;

                const breadcrumb = this.renderBreadcrumb([
                    {label: ui.status_msg, action: 'change-tab', tab: 'status'},
                    {label: data.title, action: 'show-category', tab: tabKey},
                    {label: cat.name, action: 'show-items', tab: tabKey, category: catId},
                    {label: item.name}
                ]);

                // Check if item is favorited
                const isFavorited = this.favorites.has(tabKey, catId, itemId);
                const favIcon = isFavorited ? '‚òÖ' : '‚òÜ';
                const favText = this.currentLang === 'pl' ? (isFavorited ? 'ULUBIONY' : 'ULUBIONE') : (isFavorited ? 'FAVORITED' : 'FAVORITE');
                const favClass = isFavorited ? 'bg-amber-500/20' : '';

                let specsHtml = Object.entries(item.specs).map(([key, val]) => `
                    <div class="spec-row border-gray-600">
                        <span class="font-bold ${titleClass}">${key}:</span>
                        <span class="text-right text-gray-300">${val}</span>
                    </div>`).join('');

                main.innerHTML = `
                    ${breadcrumb}
                    <div class="content-box border-2 ${borderClass} bg-[#000900]">
                        <div class="flex justify-between items-center mb-4 border-b ${borderClass} pb-2">
                            <button data-action="show-items"
                                    data-tab="${this.sanitizeDataAttr(tabKey)}"
                                    data-category="${this.sanitizeDataAttr(catId)}"
                                    class="pip-btn px-4 py-1 text-sm ${borderClass} ${titleClass} hover:bg-white/20"
                                    aria-label="Back to item list">${backBtnText}</button>
                            <button data-action="toggle-favorite"
                                    data-tab="${this.sanitizeDataAttr(tabKey)}"
                                    data-category="${this.sanitizeDataAttr(catId)}"
                                    data-item="${this.sanitizeDataAttr(itemId)}"
                                    class="pip-btn px-4 py-1 text-sm ${favClass} border-amber-300 text-amber-300 hover:bg-amber-500/30 transition-all"
                                    aria-label="Toggle favorite">${favIcon} ${favText}</button>
                            <span class="archive-tag text-lg ${titleClass} border-gray-600">${dataText}</span>
                        </div>
                        <div class="grid lg:grid-cols-2 gap-8">
                            <div>
                                <img src="${item.img}"
                                     alt="${item.name} - ${Object.values(item.specs)[0] || ''}"
                                     loading="lazy"
                                     class="w-full h-auto border-2 ${borderClass} holo-img mb-4">
                                <h2 class="text-4xl font-bold ${titleClass} mb-2">${item.name}</h2>
                            </div>
                            <div class="space-y-6">
                                <div class="bg-black/50 p-4 border ${borderClass}">
                                    <h3 class="text-xl font-bold mb-2 border-b ${borderClass} ${titleClass}">${specsText}</h3>
                                    ${specsHtml}
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold mb-2 ${titleClass}">${loreText}</h3>
                                    <p class="text-justify leading-relaxed text-lg text-gray-300">${item.lore}</p>
                                </div>
                            </div>
                        </div>
                    </div>`;
            }
        };

        // Initialize boot screen event listeners on page load
        document.addEventListener('DOMContentLoaded', function() {
            app.attachEventListeners();
        });
    </script>
</body>
</html>